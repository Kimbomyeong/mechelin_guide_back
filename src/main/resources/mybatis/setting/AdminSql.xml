<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">

	<select id="selectAllOfUser" resultType="udto" parameterType="HashMap">
	SELECT * FROM user WHERE NOT authority = 'ROLE_ADMIN' ORDER BY id LIMIT #{startPage}, #{dataCount}
	</select>
	
	<select id="selectCountOfUser" resultType="int">
	SELECT count(*) FROM user WHERE NOT authority = 'ROLE_ADMIN' ORDER BY id
	</select>
	
	<select id="searchDataOfUser" resultType="udto" parameterType="HashMap">
	SELECT * FROM user WHERE (id LIKE CONCAT('%',#{searchData},'%') OR nickname LIKE CONCAT('%',#{searchData},'%')
	OR email LIKE CONCAT('%',#{searchData},'%')	OR created_at LIKE CONCAT('%',#{searchData},'%')) AND authority != 'ROLE_ADMIN' 
	ORDER BY id LIMIT #{startPage}, #{dataCount}
	</select>
	
	<select id="sortDataOfUser" resultType="udto" parameterType="HashMap">
	SELECT * FROM user WHERE NOT authority = 'ROLE_ADMIN' 
	<choose>
		<when test = "sorting == 1">
		ORDER BY authority DESC
		</when>
		<otherwise>
		ORDER BY authority
		</otherwise>
	</choose>
	LIMIT #{startPage}, #{dataCount}
	</select>
	
	<select id="filterDataOfUser" resultType="udto" parameterType="HashMap">
	SELECT * FROM user WHERE authority != 'ROLE_ADMIN' AND
	<choose>
		<when test="sorting != 0 and filtering == 1">
		dropuser = true ORDER BY id
		</when>
		<when test="sorting != 0 and filtering == 2">
		dropuser = false ORDER BY id
		</when>
		<when test="sorting != 1 and filtering == 1">
		dropuser = true ORDER BY authority DESC
		</when>
		<when test="sorting != 1 and filtering == 2">
		dropuser = false ORDER BY authority DESC
		</when>
		<when test="sorting != 2 and filtering == 1">
		dropuser = true ORDER BY authority
		</when>
		<otherwise>
		dropuser = false ORDER BY authority
		</otherwise>
	</choose>
		LIMIT #{startPage}, #{dataCount}
	</select>
	
</mapper>